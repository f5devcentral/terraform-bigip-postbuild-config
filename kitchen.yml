---
driver:
  name: terraform
  root_module_directory: test/fixtures/aws
  parallelism: 4
  command_timeout: 1200

provisioner:
  name: terraform

verifier:
  name: terraform


platforms:
  - name: aws
    
    driver:
      root_module_directory: test/fixtures/aws
      variable_files:
        - test/assets/aws.tfvars

  - name: azure
    lifecycle:
      post_converge:
        - local: echo 'waiting 200 seconds for Azure to stabilize' && sleep 200
    driver:
      root_module_directory: test/fixtures/azure
      variable_files:
        - test/assets/azure.tfvars

  - name: aws-tunnel
    
    driver:
      root_module_directory: test/fixtures/aws_tunnel
      variable_files:
        - test/assets/aws.tfvars


suites:
  - name: bigip
    excludes:
      - aws-tunnel
    verifier:
      systems:
      - name: local
        backend: local
        profile_locations:
          - https://github.com/f5devcentral/big-ip-atc-ready.git
          - test/integration/bigip
        controls:
          - bigip-postbuildconfig-do-self
          - bigip-postbuildconfig-do-dns
          - bigip-postbuildconfig-do-vlan
          - bigip-postbuildconfig-do-provision
          - bigip-connectivity        
          - bigip-declarative-onboarding
          - bigip-declarative-onboarding-version
          - bigip-application-services
          - bigip-application-services-version
          - bigip-telemetry-streaming
          - bigip-telemetry-streaming-version
          - bigip-licensed

  - name: bigip-tunnel
    excludes:
      - aws
      - azure
    verifier:
      systems:
      - name: remote
        backend: ssh
        profile_locations:
          - test/integration/gre
        controls:
          - bigip-gre-tunnel
        hosts_output: bigip_mgmt_public_ips
        user: admin
        key_files:
          - test/fixtures/aws_tunnel/kitchen-terraform-kitchen-terraform-bigip-tunnel-aws-tunnel.pem
        
            